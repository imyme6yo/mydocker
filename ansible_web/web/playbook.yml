# @AUTHOR: imyme6yo "imyme6yo@gmail.com"
# @DRAFT: 20200803
---
    - name: create svelte project, myapp
      hosts: 127.0.0.1
      tasks:
        - name: remove docker container, myapp-web
          docker_container:
            name: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}"
            state: absent
        - name: remove docker image, myapp-web:dev
          docker_image:
            state: absent
            name: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}"
            tag: "{{ lookup('env', 'IMAGE_TAG') }}"
        - name: create docker image, myapp-web:dev
          docker_image:
            state: present
            name: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}"
            tag: "{{ lookup('env', 'IMAGE_TAG') }}"
            build:
              path: .
              dockerfile: Dockerfile.dev
              args:
                DEFUG: "{{ lookup('env', 'DEBUG') }}"
                DIR: "{{ lookup('env', 'WEB_DIR') }}"
                PROJECT: "{{ lookup('env', 'PROJECT') }}"
                SERVICE: "{{ lookup('env', 'WEB_SERVICE') }}"
                IMAGE_TAG: "{{ lookup('env', 'IMAGE_TAG') }}"
                HOST: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}"
                PORT: "{{ lookup('env', 'WEB_PORT') }}"
            source: build
        - name: run docker container, myapp-web
          docker_container:
            name: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}"
            state: started
            recreate: yes
            # auto_remove: yes
            image: "{{ lookup('env', 'PROJECT') }}-{{ lookup('env', 'WEB_SERVICE') }}:{{ lookup('env', 'IMAGE_TAG') }}"
            volumes:
              - "{{ lookup('env', 'CONTEXT') }}/{{ lookup('env', 'WEB_DIR') }}:/{{ lookup('env', 'WEB_DIR') }}"
            command: "sh /{{ lookup('env', 'WEB_DIR') }}/dev.sh"
            # detach: yes
            # interactive: yes
            # command: ash